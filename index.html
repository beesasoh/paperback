<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paperback</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src='https://connect.facebook.net/en_US/fbevents.js';
    s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script');
    fbq('init', '808533620254568');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=808533620254568&ev=PageView&noscript=1"/></noscript>
    <!-- End Meta Pixel Code -->
    <style>
        :root {
            --card-radius: 12px;
        }
        body {
            background: radial-gradient(1200px 800px at 10% -10%, #f6f8ff, transparent) no-repeat, #f8f9fa;
        }
        .book-card {
            border: 0;
            border-radius: var(--card-radius);
            box-shadow: 0 6px 16px rgba(0,0,0,.06);
            transition: transform .15s ease, box-shadow .15s ease;
            height: 100%;
            overflow: hidden;
        }
        .book-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 24px rgba(0,0,0,.12);
        }
        .cover-wrapper {
            position: relative;
            aspect-ratio: 2 / 3;
            width: 100%;
            overflow: hidden;
            background: linear-gradient(180deg, #f9fafb, #f1f3f5);
        }
        .cover-wrapper img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        .stock-badge {
            position: absolute;
            top: .5rem;
            left: .5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,.15);
        }
        .book-title-link {
            cursor: pointer;
            margin: .25rem 0 .5rem;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.8em;
        }
        .price-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: .5rem;
        }
        .cart-list img {
            height: 50px;
            width: auto;
            aspect-ratio: 2 / 3;
            object-fit: cover;
            border-radius: 4px;
        }
        #bookModalImage {
            max-height: 70vh;
            object-fit: contain;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="#" onclick="showSection('books')">ðŸ“š Paperback</a>
        <div>
            <button class="btn btn-warning" onclick="showSection('cart')">ðŸ›’ Cart (<span id="cart-count">0</span>)</button>
        </div>
    </div>
</nav>

<div class="container py-4">

    <!-- Books Section -->
    <div id="books" class="row g-4"></div>

    <!-- Cart Section -->
    <div id="cart" class="d-none">
        <h2>Your Cart</h2>
        <ul class="list-group cart-list mb-3" id="cart-items"></ul>
        <h4>Total: $<span id="cart-total">0.00</span></h4>
        <button class="btn btn-success" onclick="checkout()">Proceed to Checkout</button>
        <button class="btn btn-secondary" onclick="showSection('books')">Continue Shopping</button>
    </div>

    <!-- Checkout Section -->
    <div id="checkout" class="d-none">
        <h2>Checkout</h2>
        <p>Select a profile to auto-fill your details, or enter them manually.</p>

        <div id="profiles" class="row g-3 mb-4"></div>

        <form onsubmit="purchase(event)">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">First Name</label>
                    <input id="firstNameInput" type="text" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Last Name</label>
                    <input id="lastNameInput" type="text" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Phone Number</label>
                    <input id="phoneInput" type="tel" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input id="emailInput" type="email" class="form-control" required>
                </div>
                <div class="col-12">
                    <label class="form-label">Address</label>
                    <input id="addressInput" type="text" class="form-control">
                </div>
            </div>
            <div class="mt-3 d-flex gap-2">
                <button class="btn btn-primary">Complete Purchase</button>
                <button type="button" class="btn btn-secondary" onclick="showSection('books')">Continue Shopping</button>
            </div>
        </form>
    </div>

    <!-- Success Section -->
    <div id="success" class="d-none text-center">
        <h2>âœ… Purchase Successful!</h2>
        <p>Thank you for your order. Enjoy your books!</p>
        <button class="btn btn-primary" onclick="showSection('books')">Back to Store</button>
    </div>
</div>

<!-- Book Detail Modal -->
<div class="modal fade" id="bookModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="bookModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img id="bookModalImage" class="img-fluid mb-3" alt="Book Image">
        <p id="bookModalDescription"></p>
        <p class="fw-bold">Price: $<span id="bookModalPrice"></span></p>
        <span class="badge" id="bookModalStock"></span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="bookModalAddBtn">Add to Cart</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const imageFiles = [
    'a_half_baked_idea.jpg',
    'beach_read.webp',
    'city_of_orange.jpg',
    'dune.jpg',
    'follow_me_to_the_ground.jpg',
    'river_sing_me_home.jpg',
    'the_Great_Gatsby.jpg',
    'the_hunger_games.webp',
    'the_road.jpg',
    'whats_left_of_me.jpg'
];

function filenameToTitle(filename) {
    const nameWithoutExt = filename.replace(/\.[^/.]+$/, '');
    return nameWithoutExt
        .split(/[_-]+/)
        .map(part => part ? part.charAt(0).toUpperCase() + part.slice(1).toLowerCase() : '')
        .join(' ');
}

const booksData = imageFiles.map((file, index) => ({
    id: index + 1,
    title: filenameToTitle(file),
    description: "",
    price: 12.99,
    img: `img/${file}`,
    stock: true
}));

let cart = [];
let selectedBookId = null;
const checkoutProfiles = [
    {
        id: 'p1',
        firstName: 'Ava',
        lastName: 'Ngugi',
        phone: '+254700111222',
        email: 'ava.ngugi@prest.com',
        address: '12 Riverside Dr, Nairobi'
    },
    {
        id: 'p2',
        firstName: 'Kofi',
        lastName: 'Mensah',
        phone: '+233201234567',
        email: 'kofi.mensah@eectt.com',
        address: '5 Osu Ave, Accra'
    },
    {
        id: 'p3',
        firstName: 'Lerato',
        lastName: 'Mokoena',
        phone: '+27 82 345 6789',
        email: 'lerato.mokoena@ejonh.com',
        address: '41 Main Rd, Johannesburg'
    }
];

function renderBooks() {
    const booksContainer = document.getElementById("books");
    booksContainer.innerHTML = booksData.map(book => `
        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
            <div class="card book-card">
                <div class="cover-wrapper" onclick="openBookDetail(${book.id})">
                    <img src="${book.img}" alt="${book.title}">
                    <span class="badge stock-badge bg-${book.stock ? 'success' : 'danger'}">${book.stock ? 'In Stock' : 'Out of Stock'}</span>
                </div>
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title book-title-link line-clamp-2" onclick="openBookDetail(${book.id})">${book.title}</h6>
                    <div class="price-row mt-auto">
                        <span class="fw-bold">$${book.price.toFixed(2)}</span>
                        <button class="btn btn-sm btn-primary" ${book.stock ? '' : 'disabled'} onclick="addToCart(${book.id})">Add</button>
                    </div>
                </div>
            </div>
        </div>
    `).join("");
}

function renderProfiles() {
    const profilesContainer = document.getElementById('profiles');
    if (!profilesContainer) return;
    profilesContainer.innerHTML = checkoutProfiles.map(p => `
        <div class="col-12 col-md-4">
            <div class="card h-100" role="button" onclick="selectProfile('${p.id}')">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <strong>${p.firstName} ${p.lastName}</strong>
                        <span class="badge text-bg-light">Profile</span>
                    </div>
                    <div class="small text-muted">${p.email}</div>
                    <div class="small">${p.phone}</div>
                    <div class="small mt-2">${p.address}</div>
                </div>
            </div>
        </div>
    `).join('');
}

function selectProfile(profileId) {
    const p = checkoutProfiles.find(x => x.id === profileId);
    if (!p) return;
    document.getElementById('firstNameInput').value = p.firstName;
    document.getElementById('lastNameInput').value = p.lastName;
    document.getElementById('phoneInput').value = p.phone;
    document.getElementById('emailInput').value = p.email;
    document.getElementById('addressInput').value = p.address || '';
}

function openBookDetail(id) {
    const book = booksData.find(b => b.id === id);
    selectedBookId = id;
    if (typeof fbq === 'function') {
        fbq('track', 'ViewContent', { content_id: id });
    }
    document.getElementById("bookModalLabel").textContent = book.title;
    document.getElementById("bookModalImage").src = book.img;
    document.getElementById("bookModalDescription").textContent = book.description;
    document.getElementById("bookModalPrice").textContent = book.price.toFixed(2);
    const stockBadge = document.getElementById("bookModalStock");
    stockBadge.textContent = book.stock ? 'In Stock' : 'Out of Stock';
    stockBadge.className = `badge bg-${book.stock ? 'success' : 'danger'}`;
    document.getElementById("bookModalAddBtn").disabled = !book.stock;
    const bookModal = new bootstrap.Modal(document.getElementById('bookModal'));
    bookModal.show();
}

document.getElementById("bookModalAddBtn").addEventListener("click", function() {
    if (selectedBookId !== null) {
        addToCart(selectedBookId);
    }
});

function addToCart(id) {
    const book = booksData.find(b => b.id === id);
    cart.push(book);
    updateCartCount();
    if (typeof fbq === 'function') {
        fbq('track', 'AddToCart', { content_id: id, value: book.price, currency: 'USD' });
    }
}

function updateCartCount() {
    document.getElementById("cart-count").textContent = cart.length;
}

function showSection(section) {
    document.getElementById("books").classList.add("d-none");
    document.getElementById("cart").classList.add("d-none");
    document.getElementById("checkout").classList.add("d-none");
    document.getElementById("success").classList.add("d-none");

    document.getElementById(section).classList.remove("d-none");

    if (section === "cart") renderCart();
    if (section === "checkout") renderProfiles();
}

function renderCart() {
    const cartItems = document.getElementById("cart-items");
    let total = 0;
    cartItems.innerHTML = cart.map((item, index) => {
        total += item.price;
        return `
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <img src="${item.img}" alt="${item.title}">
                <span>${item.title}</span>
                <strong>$${item.price.toFixed(2)}</strong>
                <button class="btn btn-sm btn-danger" onclick="removeFromCart(${index})">Remove</button>
            </li>
        `;
    }).join("");
    document.getElementById("cart-total").textContent = total.toFixed(2);
}

function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartCount();
    renderCart();
}

function checkout() {
    if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
    }
    if (typeof fbq === 'function') {
        const contentIds = cart.map(item => item.id);
        fbq('track', 'InitiateCheckout', { content_ids: contentIds });
    }
    showSection("checkout");
}

function purchase(event) {
    event.preventDefault();
    const contentIds = cart.map(item => item.id);
    const totalValue = cart.reduce((sum, item) => sum + item.price, 0);
    if (typeof fbq === 'function') {
        fbq('track', 'Purchase', { content_ids: contentIds, value: Number(totalValue.toFixed(2)), currency: 'USD' });
    }
    cart = [];
    updateCartCount();
    showSection("success");
}

renderBooks();
</script>
</body>
</html>
